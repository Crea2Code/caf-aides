<app-card title="Prendre un rendez-vous" description="Planifiez un entretien personnalisÃ© avec un conseiller CAF.">
  <form [formGroup]="form" (ngSubmit)="submit()" class="form">

    <div class="form-group">
      <label for="nom">Nom complet *</label>
      <input id="nom" type="text" formControlName="nom" placeholder="Votre nom complet" />
      @if (f['nom'].touched && f['nom'].invalid) {
        <small>Nom requis (min. 2 caractÃ¨res)</small>
      }
    </div>

    <div class="form-group">
      <label for="email">Adresse e-mail *</label>
      <input id="email" type="email" formControlName="email" placeholder="exemple@domaine.fr" />
      @if (f['email'].touched && f['email'].invalid) {
        <small>Email valide requis</small>
      }
    </div>

    <div class="form-group">
      <label for="motif">Motif du rendez-vous *</label>
      <input id="motif" type="text" formControlName="motif" placeholder="Ex : Demande dâ€™aide logement" />
      @if (f['motif'].touched && f['motif'].invalid) {
        <small>Motif requis (min. 3 caractÃ¨res)</small>
      }
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="date">Date *</label>
            <input id="date" type="date" formControlName="date" [min]="todayISO" />
            <small class="hint">CrÃ©neaux ouvrÃ©s : 09:00â€“17:30, du lundi au vendredi.</small>
                @if (form.touched && form.hasError('outsideBusinessHours')) {
                @if (form.getError('outsideBusinessHours'); as oh) {
                    <small>
                    Horaire hors plage autorisÃ©e :
                    {{ oh.businessHours.start }}â€“{{ oh.businessHours.end }}.
                    </small>
                }
                }

                @if (form.touched && form.hasError('pastDateTime')) {
                <small>
                    La date/heure doit Ãªtre dans le futur
                    @if (form.getError('minMinutesAhead'); as min) {
                    (minimum {{ min }} min)
                    }.
                </small>
                }

                @if (form.touched && form.hasError('weekendNotAllowed')) {
                <small>Les rendez-vous ne sont pas possibles le week-end.</small>
                }
        </div>

        <div class="form-group">
            <label for="heure">Heure *</label>
            <input id="heure" type="time" formControlName="heure" />
            @if (f['heure'].touched && f['heure'].hasError('required')) {
            <small>Heure requise.</small>
            }
            @if (form.touched && form.hasError('pastDateTime')) {
            <small>La date/heure doit Ãªtre dans le futur.</small>
            }
            
        </div>
    </div>


    <div class="form-group">
      <label for="canal">Canal du rendez-vous *</label>
      <select id="canal" formControlName="canal">
        <option value="visio">Visio</option>
        <option value="telephone">TÃ©lÃ©phone</option>
        <option value="agence">En agence</option>
      </select>
    </div>

    <div class="form-group">
      <label for="commentaire">Commentaire (optionnel)</label>
      <textarea id="commentaire" formControlName="commentaire" rows="3" placeholder="Ajoutez un message..."></textarea>
    </div>

    <div class="form-checkbox">
      <input id="consent" type="checkbox" formControlName="consent" />
      <label for="consent">
        Jâ€™accepte que mes informations soient utilisÃ©es pour la prise de rendez-vous.
      </label>
    </div>

    <div class="form-actions">
      <app-button type="submit" [disabled]="form.invalid" label="Valider le rendez-vous"></app-button>
      <app-button type="button" variant="secondary" (clicked)="resetForm()" label="RÃ©initialiser"></app-button>
    </div>
  </form>
</app-card>

<!-- Liste des rendez-vous -->
<section class="rdv-list">
  @if (rdvs().length > 0) {
    <h3>ðŸ“… Rendez-vous enregistrÃ©s</h3>
    @for (r of rdvs(); track r.id) {
      <div class="rdv-item">
        <app-card [title]="r.motif" [description]="r.date + ' Ã  ' + r.heure">
          <p><strong>Nom :</strong> {{ r.nom }}</p>
          <p><strong>Email :</strong> {{ r.email }}</p>
          <p><strong>Canal :</strong> {{ r.canal }}</p>
          <p><strong>CrÃ©Ã© le :</strong> {{ r.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
          <app-button variant="danger" label="Supprimer" (clicked)="delete(r.id)"></app-button>
        </app-card>
      </div>
    }
  } @else {
    <section class="empty">
      <p>Aucun rendez-vous enregistrÃ© pour le moment.</p>
    </section>
  }
</section>
